/*********************************************************************************************************************
* COPYRIGHT NOTICE
* Copyright (c) 2019,?????
* All rights reserved.
* ????????QQ???????179029047(????)  ?????244861897
*
* ??????????????????????????§µ?¦Ä??????????????????????
* ?????¦Ë??¨°????????????????????????????????????????
*
* @file				isr
* @company			??????????????
* @author			?????(QQ3184284598)
* @version			??doc??version??? ?·Ú???
* @Software			IAR 8.3 or MDK 5.28
* @Target core		MM32SPIN2XPs
* @Taobao			https://seekfree.taobao.com/
* @date				2020-11-23
********************************************************************************************************************/

#include "headfile.h"
#include "isr.h"
#include "comm.h"
#include "zf_gpio.h"

void TIM1_BRK_UP_TRG_COM_IRQHandler (void)
{
	uint32 state = TIM1->SR;														// ????§Ø???
	comm_tick(1);
	TIM1->SR &= ~state;																// ????§Ø???
}

void TIM2_IRQHandler (void)
{
	uint32 state = TIM2->SR;														// ????§Ø???
    comm_handle();
	TIM2->SR &= ~state;																// ????§Ø???
}

void TIM3_IRQHandler (void)
{
	uint32 state = TIM3->SR;														// ????§Ø???
	TIM3->SR &= ~state;																// ????§Ø???
}

void TIM8_BRK_UP_TRG_COM_IRQHandler (void)
{
	uint32 state = TIM8->SR;														// ????§Ø???
	TIM8->SR &= ~state;																// ????§Ø???
}

void TIM14_IRQHandler (void)
{
	uint32 state = TIM14->SR;														// ????§Ø???
	TIM14->SR &= ~state;															// ????§Ø???
}

void TIM16_IRQHandler (void)
{
	uint32 state = TIM16->SR;														// ????§Ø???
	TIM16->SR &= ~state;															// ????§Ø???
}

void TIM17_IRQHandler (void)
{
	uint32 state = TIM17->SR;														// ????§Ø???
	TIM17->SR &= ~state;															// ????§Ø???
}

void UART1_IRQHandler(void)
{
	if(UART1->ISR & UART_ISR_TX_INTF)												// ????????????§Ø?
	{
		UART1->ICR |= UART_ICR_TXICLR;												// ????§Ø???¦Ë
	}
	if(UART1->ISR & UART_ISR_RX_INTF)												// ???????????§Ø?
	{
        UART1->ICR |= UART_ICR_RXICLR;
        gpio_set(C0, 0);
		uint8 dat = (uint8)uart_index[UART_1]->RDR;
		comm_getByte(dat);
        gpio_set(C0, 1);
	}
}

void UART2_IRQHandler(void)
{
	if(UART2->ISR & UART_ISR_TX_INTF)												// ????????????§Ø?
	{
		UART2->ICR |= UART_ICR_TXICLR;												// ????§Ø???¦Ë
	}
	if(UART2->ISR & UART_ISR_RX_INTF)												// ???????????§Ø?
	{
		switch(camera_type)															// ???????????? ¦Ä???????????????????default
		{
			case CAMERA_GRAYSCALE: 													// ?????
				mt9v03x_uart_callback();											// ???????????????????
				break;
			default:
				break;
		}
		UART2->ICR |= UART_ICR_RXICLR;												// ????§Ø???¦Ë
	}
}

void EXTI0_1_IRQHandler(void)
{
	// ?????????§Ø??????????????????????
	if(EXTI_GetITStatus(EXTI_Line0))												// ??? line0 ????
	{
		EXTI_ClearFlag(EXTI_Line0);													// ??? line0 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line1))												// ??? line1 ????
	{
		EXTI_ClearFlag(EXTI_Line1);													// ??? line1 ???????
	}
//	EXTI_ClearFlag(0x0003);															// EXTI_Line0 | EXTI_Line1
}

void EXTI2_3_IRQHandler(void)
{
	// ?????????§Ø??????????????????????
	if(EXTI_GetITStatus(EXTI_Line2))												// ??? line2 ????
	{
		EXTI_ClearFlag(EXTI_Line2);													// ??? line2 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line3))												// ??? line3 ????
	{
		EXTI_ClearFlag(EXTI_Line3);													// ??? line3 ???????
	}
//	EXTI_ClearFlag(0x000C);															// EXTI_Line2 | EXTI_Line3
}

void EXTI4_15_IRQHandler(void)
{
	// ?????????§Ø??????????????????????
	if(EXTI_GetITStatus(EXTI_Line4))												// ??? line4 ????
	{
		EXTI_ClearFlag(EXTI_Line4);													// ??? line4 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line5))												// ??? line5 ????
	{
		EXTI_ClearFlag(EXTI_Line5);													// ??? line5 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line6))												// ??? line6 ????
	{
		EXTI_ClearFlag(EXTI_Line6);													// ??? line6 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line7))												// ??? line7 ????
	{
		switch(camera_type)															// ???????????? ¦Ä???????????????????default
		{
			case CAMERA_GRAYSCALE: 													// ?????
				mt9v03x_vsync();
				break;
			default:
				break;
		}
		EXTI_ClearFlag(EXTI_Line7);													// ??? line8 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line8))												// ??? line8 ????
	{
		EXTI_ClearFlag(EXTI_Line8);													// ??? line8 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line9))												// ??? line9 ????
	{
		EXTI_ClearFlag(EXTI_Line9);													// ??? line9 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line10))												// ??? line10 ????
	{
		EXTI_ClearFlag(EXTI_Line10);												// ??? line10 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line11))												// ??? line11 ????
	{
		EXTI_ClearFlag(EXTI_Line11);												// ??? line11 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line12))												// ??? line12 ????
	{
		EXTI_ClearFlag(EXTI_Line12);												// ??? line12 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line13))												// ??? line13 ????
	{
		EXTI_ClearFlag(EXTI_Line13);												// ??? line13 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line14))												// ??? line14 ????
	{
		EXTI_ClearFlag(EXTI_Line14);												// ??? line14 ???????
	}
	if(EXTI_GetITStatus(EXTI_Line15))												// ??? line15 ????
	{
		EXTI_ClearFlag(EXTI_Line15);												// ??? line15 ???????
	}
//	EXTI_ClearFlag(0xFFF0);															// EXTI_Line4 | ... | EXTI_Line15
}

void DMA1_Channel1_IRQHandler(void)
{
	if(SET == DMA_GetFlagStatus(DMA1_FLAG_TC1))										// ?§Ø???????
	{
		DMA_ClearFlag(DMA1_FLAG_TC1);												// ????????§Ø???
	}
}

void DMA1_Channel2_3_IRQHandler(void)
{
	if(SET == DMA_GetFlagStatus(DMA1_FLAG_TC2))										// ?§Ø???????
	{
		DMA_ClearFlag(DMA1_FLAG_TC2);												// ????????§Ø???
	}
	if(SET == DMA_GetFlagStatus(DMA1_FLAG_TC3))										// ?§Ø???????
	{
		DMA_ClearFlag(DMA1_FLAG_TC3);												// ????????§Ø???
	}
}

void DMA1_Channel4_5_IRQHandler(void)
{
	if(SET == DMA_GetFlagStatus(DMA1_FLAG_TC4))										// ?§Ø???????
	{
		DMA_ClearFlag(DMA1_FLAG_TC4);												// ????????§Ø???
		switch(camera_type)															// ???????????? ¦Ä???????????????????default
		{
			case CAMERA_GRAYSCALE: 													// ?????
				mt9v03x_dma();
				break;
			default:
				break;
		}
	}
	if(SET == DMA_GetFlagStatus(DMA1_FLAG_TC5))										// ?§Ø???????
	{
		DMA_ClearFlag(DMA1_FLAG_TC5);												// ????????§Ø???
	}
}

#ifdef Will_never_be_defined
WWDG_IRQHandler
PVD_IRQHandler
PWM_IRQHandler
FLASH_IRQHandler
RCC_IRQHandler
EXTI0_1_IRQHandler
EXTI2_3_IRQHandler
EXTI4_15_IRQHandler
HWDIV_IRQHandler
DMA1_Channel1_IRQHandler
DMA1_Channel2_3_IRQHandler
DMA1_Channel4_5_IRQHandler
ADC1_IRQHandler
TIM1_BRK_UP_TRG_COM_IRQHandler
TIM1_CC_IRQHandler
TIM2_IRQHandler
TIM3_IRQHandler
TIM8_BRK_UP_TRG_COM_IRQHandler
TIM8_CC_IRQHandler
TIM14_IRQHandler
ADC2_IRQHandler
TIM16_IRQHandler
TIM17_IRQHandler
I2C1_IRQHandler
COMP1_2_3_4_5_IRQHandler
SPI1_IRQHandler
SPI2_IRQHandler
UART1_IRQHandler
UART2_IRQHandler
#endif
