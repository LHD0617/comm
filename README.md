# comm

## 前言
本项目为一个轻量级点对点可靠串行通信协议，依赖于list库与fifo库，可在本人github中找到源码，本协议属于运输层协议采取类似TCP协议，协议所占内存小，执行效率高可用在嵌入式设备当中，移植方便无需依赖外部库。具有超时重传机制，校验失败重传机制，可达到至少送达一次效果。协议使用内存可配置。

## 使用方法
---

### 1.加入工程
    将comm.c comm.h list.c ist.h fifo.c fifo.h 添加到目标工程当中
### 2.配置协议节拍输入
    周期调用 “comm_tick” 函数输入ms节拍数，推荐设置1ms定时中断周期输入1节拍
### 3.重写comm_putBuf
    comm_putBuf为虚函数用户可在任意包含comm.h的c文件中重写该函数，协议将自动调用用户重写的comm_putBuf函数（切记不可加__WEAK修饰）
    该函数为协议数据流输出函数，用户需将在函数中实现数据发送，若数据发送成功则返回COMM_ERR_SUCCESS，否则返回COMM_ERR_UNKNOW即可
### 4.配置协议数据输入
    用户需将调用comm_getByte或comm_getBuf函数向协议输入数据，如使用串口通信则在串口接收中断中调用comm_getByte函数输入数据即可
### 5.注册回调函数
    用户需要向协议注册回调函数，当协议收到目标标签数据后自动执行回调函数，切记回调函数TAG必须时系统唯一的，协议保留0-3的TAG为系统TAG用户可使用4-255，用户注册的回调函数不可执行时间过长，否则将导致协议运行阻塞
### 5.启动协议
    将协议各个接口配置好后方可启动运行协议，调用comm_start函数启动协议，需判断函数返回值是否启动成功。
### 6.协议处理
    用户需周期调用comm_handle函数来保证协议运行该函数为协议处理函数，当用户发送数据时并非直接调用硬件接口发送，而是先存到发送数据队列中等待comm_handle函数执行时发送，处理函数执行频率无需过高和通信信道数据量匹配即可用户自行决定comm_handle调用频率。
### 7.发送数据
    用户调用comm_send函数输入数据tlv协议将自行吧数据至少发送到对方一次
---